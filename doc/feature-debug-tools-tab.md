# 功能：调试工具独立标签页

## 概述

将调试工具配置从"服务配置"标签页中独立出来，作为一个单独的标签页，方便用户快速启用和配置调试工具。

## 实现内容

### 1. 新增调试工具标签页

**位置：** 服务详情页 → 调试工具 Tab

**功能：**
- 独立的调试工具配置界面
- 支持启用/禁用调试工具
- 支持选择和配置多种调试工具
- 提供快速预设选择
- 显示使用说明和提示

### 2. 文件变更

#### 新增文件

1. **`src/components/services/DebugToolsTab.tsx`**
   - 调试工具标签页组件
   - 包含编辑/保存/取消操作
   - 集成 DebugToolsSection 组件
   - 提供使用提示卡片

#### 修改文件

1. **`src/types/service-tabs.ts`**
   - 添加 `DEBUG_TOOLS` 到 `TAB_VALUES`
   - 新增 `DebugToolsTabProps` 接口

2. **`src/components/services/LazyTabComponents.tsx`**
   - 添加 `LazyDebugToolsTab` 懒加载组件
   - 导出 `DebugToolsTabProps` 类型

3. **`src/lib/service-tab-config.ts`**
   - 添加调试工具 tab 配置
   - 更新 tab 总数从 8 个到 9 个
   - 添加 Wrench 图标导入

4. **`src/components/services/ConfigurationTab.tsx`**
   - 移除调试工具部分
   - 简化配置标签页内容
   - 移除相关导入和代码

5. **`src/app/projects/[id]/services/[serviceId]/page.tsx`**
   - 添加调试工具 TabsContent
   - 导入 LazyDebugToolsTab
   - 集成到 tab 渲染逻辑

## 用户体验改进

### 之前
- 调试工具配置隐藏在"服务配置"标签页的底部
- 需要滚动才能找到
- 与其他配置混在一起，不够突出

### 现在
- 独立的"调试工具"标签页
- 一键切换，快速访问
- 专注的配置界面
- 清晰的使用提示

## 标签页顺序

服务详情页的标签页顺序（共 9 个）：

1. **概览** - 服务状态和监控
2. **服务配置** - 基础配置、卷挂载、资源限制
3. **环境变量** - 环境变量管理
4. **网络** - 网络和域名配置
5. **调试工具** ⭐ 新增 - 调试工具配置
6. **部署** - 部署历史和镜像管理
7. **日志** - 实时日志查看
8. **文件** - 文件浏览和管理
9. **YAML** - Kubernetes 配置预览

## 界面设计

### 页面头部
- 左侧：Wrench 图标 + 标题 + 描述
- 右侧：编辑配置 / 保存 + 取消 按钮

### 主要内容
- **调试工具配置卡片**
  - 启用/禁用开关
  - 快速预设选择器
  - 工具选择和配置
  - 验证错误提示
  - 使用说明

### 提示卡片
- 蓝色背景的信息卡片
- 包含 4 条使用提示：
  1. 通过 Init Container 注入，不修改主镜像
  2. 工具安装在共享卷中
  3. 修改后需要重新部署
  4. 建议在开发测试环境使用

## 技术实现

### 组件架构

```
DebugToolsTab (新增)
  ├── 页面头部（标题、描述、操作按钮）
  ├── 调试工具配置卡片
  │   └── DebugToolsSection (复用)
  │       ├── 启用开关
  │       ├── 快速预设选择器
  │       ├── 工具卡片列表
  │       ├── 验证错误提示
  │       └── 使用说明
  └── 提示卡片
```

### 状态管理

- 使用受控组件模式
- 状态由父组件（服务详情页）管理
- 通过 props 传递：
  - `service`: 当前服务数据
  - `isEditing`: 编辑状态
  - `editedService`: 编辑中的服务数据
  - `onUpdateService`: 更新服务回调

### 懒加载

- 使用 Next.js dynamic import
- 仅在切换到该 tab 时加载
- 减少初始页面加载时间

## 使用场景

### 快速启用调试工具
1. 进入服务详情页
2. 点击"调试工具"标签
3. 点击"编辑配置"
4. 开启"启用调试工具"开关
5. 选择需要的工具（或使用快速预设）
6. 点击"保存"
7. 重新部署服务

### 修改调试工具配置
1. 进入"调试工具"标签
2. 点击"编辑配置"
3. 修改工具选择或配置
4. 点击"保存"
5. 重新部署服务

### 禁用调试工具
1. 进入"调试工具"标签
2. 点击"编辑配置"
3. 关闭"启用调试工具"开关
4. 点击"保存"
5. 重新部署服务

## 相关文档

- [调试工具功能说明](./debug-tools-feature.md)
- [调试工具无限循环 Bug 修复](./bugfix-debug-tools-infinite-loop.md)
- [项目管理使用指南](./项目管理使用指南.md)

## 后续优化建议

1. **实时生效**
   - 考虑支持不重新部署即可生效（通过 kubectl patch）
   - 需要评估技术可行性和安全性

2. **工具状态显示**
   - 在概览页显示已启用的调试工具
   - 显示工具安装状态

3. **使用统计**
   - 记录调试工具的使用频率
   - 帮助优化默认预设

4. **更多工具**
   - 根据用户反馈添加更多常用工具
   - 支持自定义工具镜像

## 测试建议

### 功能测试
- [ ] 标签页正常显示
- [ ] 启用/禁用调试工具
- [ ] 选择和配置工具
- [ ] 保存和取消操作
- [ ] 重新部署后工具生效

### 兼容性测试
- [ ] Application 服务类型
- [ ] Database 服务类型
- [ ] Image 服务类型

### 性能测试
- [ ] 懒加载正常工作
- [ ] 切换标签页流畅
- [ ] 无内存泄漏

## 发布日期

2024-12-04

## 版本

v1.0
