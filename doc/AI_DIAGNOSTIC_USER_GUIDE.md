# AI 诊断助手 - 用户使用指南

## 简介

AI 诊断助手是一个智能化的服务问题诊断工具，集成在服务详情页中。通过自然语言对话，AI 助手可以帮助您快速定位和解决 Kubernetes 服务的各种问题。

### 核心功能

- 🤖 **自然语言交互**：用日常语言描述问题，无需记忆复杂命令
- 🔍 **智能诊断**：自动收集服务状态、日志、指标等信息
- 📊 **实时分析**：流式展示分析过程，让您了解每一步
- 💡 **专业建议**：基于最佳实践提供具体的解决方案

### 适用场景

- Pod 启动失败或频繁重启
- 应用程序报错或异常
- 服务性能问题（CPU、内存使用率高）
- 网络连接问题
- 配置错误排查
- 日志分析和问题定位

## 快速开始

### 1. 打开 AI 诊断助手

1. 访问任意服务的详情页
2. 在页面顶部找到 **"AI 诊断"** 按钮
3. 点击按钮，诊断面板将从右侧滑出

![AI 诊断按钮位置示意]

### 2. 描述您的问题

在输入框中用自然语言描述您遇到的问题，例如：

- "这个服务为什么启动失败？"
- "帮我分析一下最近的错误日志"
- "CPU 使用率为什么这么高？"
- "服务无法连接到数据库"

### 3. 等待 AI 分析

AI 助手会：
1. 理解您的问题
2. 自动收集相关信息（Pod 状态、日志、指标等）
3. 分析数据并找出问题根源
4. 提供诊断结果和解决建议

### 4. 查看诊断结果

AI 会以结构化的方式展示诊断结果：

- **问题观察**：发现的症状和异常
- **根因分析**：问题的根本原因
- **解决建议**：具体的修复步骤

### 5. 继续对话

如果需要更多信息或有其他问题，可以继续提问：

- "能详细解释一下这个错误吗？"
- "还有其他可能的原因吗？"
- "如何预防这个问题再次发生？"

## 使用技巧

### 如何提出好问题

**✅ 推荐的提问方式：**

- **具体描述症状**：
  - ✅ "Pod 一直在 CrashLoopBackOff 状态"
  - ❌ "服务有问题"

- **说明观察到的现象**：
  - ✅ "应用日志里一直报 Connection refused 错误"
  - ❌ "不知道为什么不工作"

- **提供上下文**：
  - ✅ "刚刚更新了配置后服务就启动不了了"
  - ❌ "启动不了"

- **明确您的目标**：
  - ✅ "帮我找出为什么内存使用率突然升高"
  - ❌ "看看内存"

### 理解 AI 的工作流程

AI 诊断助手会按照以下流程工作：

```
1. 理解问题
   ↓
2. 收集信息
   - 查询 Pod 状态和事件
   - 读取服务日志
   - 获取资源使用指标
   - 检查部署配置
   ↓
3. 分析数据
   - 识别异常模式
   - 关联多个数据源
   - 应用诊断规则
   ↓
4. 生成建议
   - 确定根本原因
   - 提供解决方案
   - 给出预防措施
```

### 查看工具调用

在对话过程中，您会看到 AI 调用的工具：

- **🔍 getPodStatus**：查询 Pod 状态和事件
- **📝 getServiceLogs**：读取服务日志
- **📊 getResourceMetrics**：获取 CPU 和内存指标
- **⚙️ getDeploymentConfig**：查看部署配置

这些工具调用会显示状态：
- ⏳ **运行中**：正在执行
- ✅ **成功**：执行完成
- ❌ **失败**：执行出错

## 常见使用场景

### 场景 1：Pod 启动失败

**问题描述：**
```
"我的服务启动失败了，Pod 一直在 CrashLoopBackOff 状态"
```

**AI 会做什么：**
1. 查询 Pod 状态和事件
2. 检查容器退出代码
3. 读取启动日志
4. 分析失败原因

**可能的诊断结果：**
- 镜像拉取失败（ImagePullBackOff）
- 配置错误（ConfigMap 不存在）
- 应用程序启动失败（代码错误）
- 资源不足（内存限制过低）

**后续提问：**
- "能看一下具体的错误日志吗？"
- "这个配置应该怎么修改？"

---

### 场景 2：应用程序报错

**问题描述：**
```
"应用日志里一直报错，但是 Pod 状态是 Running"
```

**AI 会做什么：**
1. 确认 Pod 运行状态
2. 读取最近的应用日志
3. 识别错误类型和频率
4. 分析错误原因

**可能的诊断结果：**
- 数据库连接失败
- 外部 API 调用超时
- 文件权限问题
- 配置参数错误

**后续提问：**
- "这个错误是什么时候开始出现的？"
- "如何修复数据库连接问题？"

---

### 场景 3：性能问题

**问题描述：**
```
"服务响应很慢，怀疑是资源不足"
```

**AI 会做什么：**
1. 查询当前资源使用情况
2. 检查资源限制配置
3. 计算使用率
4. 分析是否存在瓶颈

**可能的诊断结果：**
- CPU 使用率达到 95%，接近限制
- 内存使用持续增长（可能内存泄漏）
- 资源限制设置过低
- 需要扩容或优化

**后续提问：**
- "应该把资源限制调整到多少？"
- "如何判断是否有内存泄漏？"

---

### 场景 4：网络连接问题

**问题描述：**
```
"服务无法连接到数据库，一直超时"
```

**AI 会做什么：**
1. 检查 Pod 网络事件
2. 查看连接错误日志
3. 验证网络配置
4. 检查服务发现配置

**可能的诊断结果：**
- 数据库服务地址配置错误
- 网络策略阻止连接
- DNS 解析失败
- 数据库服务不可用

**后续提问：**
- "如何测试网络连接？"
- "数据库服务的正确地址是什么？"

---

### 场景 5：配置问题

**问题描述：**
```
"服务启动后立即退出，没有明显错误"
```

**AI 会做什么：**
1. 检查容器退出代码
2. 查看部署配置
3. 读取启动日志
4. 验证环境变量和挂载

**可能的诊断结果：**
- 必需的环境变量缺失
- ConfigMap 或 Secret 不存在
- 挂载路径冲突
- 启动命令配置错误

**后续提问：**
- "缺少哪些环境变量？"
- "如何正确配置 ConfigMap？"

## 最佳实践

### 1. 提供充分的上下文

在提问时，提供以下信息会帮助 AI 更准确地诊断：

- **时间信息**："刚刚"、"昨天开始"、"更新后"
- **操作历史**："修改了配置"、"重启了服务"、"扩容到 3 个副本"
- **观察到的现象**："日志里有错误"、"响应变慢"、"无法访问"

### 2. 逐步深入

如果问题复杂，可以分步骤提问：

1. 先了解整体状态："服务现在是什么状态？"
2. 再深入细节："能看一下错误日志吗？"
3. 最后寻求建议："应该如何修复？"

### 3. 验证建议

AI 提供建议后，您可以：

- 询问更多细节："为什么要这样修改？"
- 了解影响范围："这个改动会影响其他服务吗？"
- 请求替代方案："还有其他解决办法吗？"

### 4. 保持对话连贯

AI 会记住对话历史，您可以：

- 引用之前的内容："你刚才提到的那个配置"
- 继续深入："关于这个问题，还有什么需要注意的？"
- 关联问题："这个问题和之前的错误有关系吗？"

### 5. 明确表达需求

如果 AI 的回答不够具体，可以：

- 要求详细说明："能详细解释一下吗？"
- 请求具体步骤："具体应该怎么操作？"
- 寻求示例："能给个配置示例吗？"

## 功能限制

### 当前版本支持的功能

✅ **支持的诊断类型：**
- Pod 状态和事件查询
- 服务日志读取（最近 1000 行）
- 资源使用指标查询
- 部署配置查看

✅ **支持的问题类型：**
- 启动失败
- 应用程序错误
- 性能问题
- 网络连接问题
- 配置错误

### 当前版本不支持的功能

❌ **暂不支持：**
- 自动修复操作（仅提供建议）
- 历史会话保存和恢复
- 实时监听和主动告警
- 跨服务关联分析
- 代码级别的调试

这些功能将在后续版本中逐步实现。

## 隐私和安全

### 数据处理

- **本地处理**：AI 模型运行在本地，数据不会发送到外部
- **临时存储**：对话内容仅在会话期间保存，关闭面板后清除
- **权限控制**：只能访问您有权限查看的服务信息

### 敏感信息

AI 助手会尽量避免显示敏感信息：

- 密码和密钥会被自动过滤
- 敏感配置会被标记
- 建议您不要在对话中输入敏感信息

### 审计日志

所有 AI 诊断操作都会记录审计日志，包括：

- 用户身份
- 访问的服务
- 执行的操作
- 时间戳

## 故障排除

### 问题：AI 诊断按钮不可见

**可能原因：**
- 功能未启用
- 浏览器缓存问题
- 权限不足

**解决方法：**
1. 刷新页面（Ctrl+F5 或 Cmd+Shift+R）
2. 清除浏览器缓存
3. 联系管理员确认功能是否启用

---

### 问题：点击按钮后面板无法打开

**可能原因：**
- WebSocket 连接失败
- 网络问题
- 服务器未启动

**解决方法：**
1. 检查浏览器控制台是否有错误
2. 确认 WebSocket 服务器正在运行
3. 检查网络连接
4. 联系技术支持

---

### 问题：AI 响应很慢或无响应

**可能原因：**
- AI 模型加载中
- 服务器负载高
- 网络延迟

**解决方法：**
1. 首次使用时等待模型加载（约 10-30 秒）
2. 检查服务器资源使用情况
3. 稍后重试
4. 如果持续无响应，联系技术支持

---

### 问题：AI 的回答不准确

**可能原因：**
- 问题描述不够清晰
- 缺少必要的上下文
- AI 模型限制

**解决方法：**
1. 提供更详细的问题描述
2. 补充相关的上下文信息
3. 尝试换一种方式提问
4. 如果问题复杂，可以分步骤提问

---

### 问题：显示"模拟模式"

**可能原因：**
- AI 模型未正确配置
- 服务器配置问题

**解决方法：**
1. 联系管理员检查 AI 配置
2. 参考 [故障排查指南](./AI_DIAGNOSTIC_TROUBLESHOOTING.md)
3. 模拟模式下功能受限，建议配置真实 AI

## 获取帮助

### 文档资源

- **快速开始**：[AI_DIAGNOSTIC_QUICK_START.md](./AI_DIAGNOSTIC_QUICK_START.md)
- **配置指南**：[AI_DIAGNOSTIC_LLM_SETUP.md](./AI_DIAGNOSTIC_LLM_SETUP.md)
- **故障排查**：[AI_DIAGNOSTIC_TROUBLESHOOTING.md](./AI_DIAGNOSTIC_TROUBLESHOOTING.md)
- **常见问题**：[AI_DIAGNOSTIC_FAQ.md](./AI_DIAGNOSTIC_FAQ.md)

### 技术支持

如果遇到问题：

1. **查看文档**：先查阅相关文档
2. **检查日志**：查看浏览器控制台和服务器日志
3. **收集信息**：准备错误信息和截图
4. **联系支持**：通过以下方式获取帮助
   - 技术支持邮箱
   - 内部支持渠道
   - 提交工单

### 反馈建议

我们欢迎您的反馈和建议：

- **功能建议**：您希望 AI 助手支持哪些新功能？
- **使用体验**：使用过程中有哪些不便之处？
- **准确性反馈**：AI 的诊断是否准确？
- **文档改进**：文档是否清晰易懂？

## 更新日志

### v1.0.0 (MVP)

**功能：**
- ✅ AI 诊断面板
- ✅ 自然语言交互
- ✅ Pod 状态查询
- ✅ 日志读取
- ✅ 资源指标查询
- ✅ 配置查看
- ✅ 流式响应

**限制：**
- ❌ 不支持自动修复
- ❌ 不支持会话保存
- ❌ 不支持实时监听

### 未来计划

**v1.1.0（计划中）：**
- 自动修复建议
- 会话历史保存
- 更多诊断工具

**v1.2.0（计划中）：**
- 实时监听和告警
- 跨服务关联分析
- 知识库学习

---

**最后更新**：2024-12-05  
**版本**：1.0.0  
**维护者**：开发团队
