# è°ƒè¯•å·¥å…·åŠŸèƒ½æµ‹è¯•æŒ‡å—

## éƒ¨ç½²å‰å‡†å¤‡

### 1. æ•°æ®åº“è¿ç§»

```bash
# æ–¹å¼ 1: ä½¿ç”¨ Prisma CLI
npx prisma migrate deploy

# æ–¹å¼ 2: æ‰‹åŠ¨æ‰§è¡Œ SQL
mysql -u root -p xuanwu_next < prisma/migrations/20251202000000_add_debug_config/migration.sql
```

### 2. é‡æ–°ç”Ÿæˆ Prisma Client

```bash
npx prisma generate
```

### 3. é‡å¯å¼€å‘æœåŠ¡å™¨

```bash
pnpm dev
```

---

## åŠŸèƒ½æµ‹è¯•æ¸…å•

### âœ… æµ‹è¯• 1: UI ç»„ä»¶æ˜¾ç¤º

**æ­¥éª¤**:
1. è®¿é—®ä»»æ„æœåŠ¡è¯¦æƒ…é¡µ
2. ç‚¹å‡»"é…ç½®"æ ‡ç­¾é¡µ
3. æ»šåŠ¨åˆ°åº•éƒ¨ï¼ŒæŸ¥çœ‹"è°ƒè¯•å·¥å…·"å¡ç‰‡

**é¢„æœŸç»“æœ**:
- æ˜¾ç¤º"è°ƒè¯•å·¥å…·"å¡ç‰‡
- æ˜¾ç¤º"å¯ç”¨è°ƒè¯•å·¥å…·"å¼€å…³ï¼ˆé»˜è®¤å…³é—­ï¼‰
- æ˜¾ç¤ºè¯´æ˜æ–‡å­—

---

### âœ… æµ‹è¯• 2: å¯ç”¨è°ƒè¯•å·¥å…·

**æ­¥éª¤**:
1. ç‚¹å‡»"ç¼–è¾‘é…ç½®"æŒ‰é’®
2. æ‰“å¼€"å¯ç”¨è°ƒè¯•å·¥å…·"å¼€å…³
3. æŸ¥çœ‹å·¥å…·é›†é€‰é¡¹

**é¢„æœŸç»“æœ**:
- æ˜¾ç¤º 4 ä¸ªå·¥å…·é›†é€‰é¡¹ï¼ˆBusyBoxã€Netshootã€Ubuntuã€è‡ªå®šä¹‰ï¼‰
- é»˜è®¤é€‰ä¸­ BusyBox
- æ˜¾ç¤ºæŒ‚è½½è·¯å¾„è¾“å…¥æ¡†ï¼ˆé»˜è®¤ `/debug-tools`ï¼‰
- æ˜¾ç¤ºä½¿ç”¨è¯´æ˜

---

### âœ… æµ‹è¯• 3: åˆ‡æ¢å·¥å…·é›†

**æ­¥éª¤**:
1. é€‰æ‹©ä¸åŒçš„å·¥å…·é›†ï¼ˆBusyBox â†’ Netshoot â†’ Ubuntuï¼‰
2. è§‚å¯Ÿæ¯ä¸ªé€‰é¡¹çš„æè¿°å’Œé•œåƒä¿¡æ¯

**é¢„æœŸç»“æœ**:
- å¯ä»¥æ­£å¸¸åˆ‡æ¢
- æ¯ä¸ªå·¥å…·é›†æ˜¾ç¤ºæ­£ç¡®çš„æè¿°å’Œé•œåƒåœ°å€
- é€‰ä¸­çš„å·¥å…·é›†é«˜äº®æ˜¾ç¤º

---

### âœ… æµ‹è¯• 4: è‡ªå®šä¹‰é•œåƒ

**æ­¥éª¤**:
1. é€‰æ‹©"è‡ªå®šä¹‰é•œåƒ"
2. è¾“å…¥è‡ªå®šä¹‰é•œåƒåœ°å€ï¼ˆå¦‚ `busybox:1.36`ï¼‰

**é¢„æœŸç»“æœ**:
- æ˜¾ç¤ºè‡ªå®šä¹‰é•œåƒè¾“å…¥æ¡†
- å¯ä»¥è¾“å…¥é•œåƒåœ°å€
- æ˜¾ç¤ºæç¤ºä¿¡æ¯

---

### âœ… æµ‹è¯• 5: ä¿å­˜é…ç½®

**æ­¥éª¤**:
1. å¯ç”¨è°ƒè¯•å·¥å…·ï¼Œé€‰æ‹© BusyBox
2. ç‚¹å‡»"ä¿å­˜"æŒ‰é’®
3. åˆ·æ–°é¡µé¢

**é¢„æœŸç»“æœ**:
- ä¿å­˜æˆåŠŸ
- åˆ·æ–°åé…ç½®ä¿æŒä¸å˜
- è°ƒè¯•å·¥å…·ä»ç„¶æ˜¾ç¤ºä¸ºå¯ç”¨çŠ¶æ€

---

### âœ… æµ‹è¯• 6: éƒ¨ç½²æœåŠ¡ï¼ˆApplicationï¼‰

**æ­¥éª¤**:
1. åˆ›å»ºæˆ–é€‰æ‹©ä¸€ä¸ª Application ç±»å‹çš„æœåŠ¡
2. å¯ç”¨è°ƒè¯•å·¥å…·ï¼ˆBusyBoxï¼‰
3. ä¿å­˜é…ç½®
4. ç‚¹å‡»"éƒ¨ç½²"æŒ‰é’®
5. ç­‰å¾…éƒ¨ç½²å®Œæˆ

**é¢„æœŸç»“æœ**:
- éƒ¨ç½²æˆåŠŸ
- Pod æ­£å¸¸è¿è¡Œ
- æŸ¥çœ‹ Pod YAMLï¼Œåº”åŒ…å« Init Container

**éªŒè¯å‘½ä»¤**:
```bash
# æŸ¥çœ‹ Pod
kubectl get pods -n <namespace> -l app=<service-name>

# æŸ¥çœ‹ Pod è¯¦æƒ…
kubectl describe pod <pod-name> -n <namespace>

# åº”è¯¥çœ‹åˆ° Init Container: install-debug-tools

# æŸ¥çœ‹ Init Container æ—¥å¿—
kubectl logs <pod-name> -n <namespace> -c install-debug-tools

# åº”è¯¥çœ‹åˆ°: "BusyBox tools installed successfully at /debug-tools"
```

---

### âœ… æµ‹è¯• 7: ä½¿ç”¨è°ƒè¯•å·¥å…·

**æ­¥éª¤**:
1. è¿›å…¥å®¹å™¨
2. æµ‹è¯•è°ƒè¯•å·¥å…·

**å‘½ä»¤**:
```bash
# è¿›å…¥å®¹å™¨
kubectl exec -it <pod-name> -n <namespace> -- sh

# æµ‹è¯•å·¥å…·ï¼ˆå®Œæ•´è·¯å¾„ï¼‰
/debug-tools/ls -la
/debug-tools/ps aux
/debug-tools/netstat -tulpn

# æ·»åŠ åˆ° PATH
export PATH=/debug-tools:$PATH

# æµ‹è¯•å·¥å…·ï¼ˆç®€çŸ­å‘½ä»¤ï¼‰
ls -la
ps aux
netstat -tulpn
```

**é¢„æœŸç»“æœ**:
- æ‰€æœ‰å‘½ä»¤æ­£å¸¸æ‰§è¡Œ
- å·¥å…·å¯ç”¨ä¸”åŠŸèƒ½æ­£å¸¸

---

### âœ… æµ‹è¯• 8: éƒ¨ç½²æœåŠ¡ï¼ˆDatabaseï¼‰

**æ­¥éª¤**:
1. åˆ›å»ºæˆ–é€‰æ‹©ä¸€ä¸ª Database ç±»å‹çš„æœåŠ¡ï¼ˆå¦‚ MySQLï¼‰
2. å¯ç”¨è°ƒè¯•å·¥å…·ï¼ˆBusyBoxï¼‰
3. ä¿å­˜é…ç½®
4. ç‚¹å‡»"éƒ¨ç½²"æŒ‰é’®
5. ç­‰å¾…éƒ¨ç½²å®Œæˆ

**é¢„æœŸç»“æœ**:
- éƒ¨ç½²æˆåŠŸ
- StatefulSet æ­£å¸¸è¿è¡Œ
- æŸ¥çœ‹ StatefulSet YAMLï¼Œåº”åŒ…å« Init Container

**éªŒè¯å‘½ä»¤**:
```bash
# æŸ¥çœ‹ StatefulSet
kubectl get statefulset -n <namespace>

# æŸ¥çœ‹ Pod
kubectl get pods -n <namespace> -l app=<service-name>

# è¿›å…¥å®¹å™¨æµ‹è¯•
kubectl exec -it <pod-name> -n <namespace> -- /debug-tools/ls -la
```

---

### âœ… æµ‹è¯• 9: Netshoot å·¥å…·é›†

**æ­¥éª¤**:
1. é€‰æ‹© Netshoot å·¥å…·é›†
2. ä¿å­˜å¹¶éƒ¨ç½²
3. è¿›å…¥å®¹å™¨æµ‹è¯•ç½‘ç»œå·¥å…·

**å‘½ä»¤**:
```bash
kubectl exec -it <pod-name> -n <namespace> -- sh

# æµ‹è¯•ç½‘ç»œå·¥å…·
/debug-tools/bin/curl --version
/debug-tools/bin/dig google.com
/debug-tools/bin/nslookup kubernetes.default

# å¦‚æœæœ‰ tcpdump
/debug-tools/bin/tcpdump --version
```

**é¢„æœŸç»“æœ**:
- ç½‘ç»œå·¥å…·å¯ç”¨
- å¯ä»¥æ‰§è¡Œç½‘ç»œè¯Šæ–­å‘½ä»¤

---

### âœ… æµ‹è¯• 10: ç¦ç”¨è°ƒè¯•å·¥å…·

**æ­¥éª¤**:
1. ç¼–è¾‘é…ç½®
2. å…³é—­"å¯ç”¨è°ƒè¯•å·¥å…·"å¼€å…³
3. ä¿å­˜é…ç½®
4. é‡æ–°éƒ¨ç½²

**é¢„æœŸç»“æœ**:
- ä¿å­˜æˆåŠŸ
- é‡æ–°éƒ¨ç½²åï¼ŒPod ä¸­ä¸åŒ…å« Init Container
- å®¹å™¨ä¸­æ²¡æœ‰ `/debug-tools` ç›®å½•

**éªŒè¯å‘½ä»¤**:
```bash
# æŸ¥çœ‹ Pod è¯¦æƒ…
kubectl describe pod <pod-name> -n <namespace>

# åº”è¯¥æ²¡æœ‰ Init Container

# è¿›å…¥å®¹å™¨æ£€æŸ¥
kubectl exec -it <pod-name> -n <namespace> -- ls /debug-tools

# åº”è¯¥æç¤º: No such file or directory
```

---

### âœ… æµ‹è¯• 11: é”™è¯¯å¤„ç†

**æµ‹è¯•åœºæ™¯ A: æ— æ•ˆçš„è‡ªå®šä¹‰é•œåƒ**

**æ­¥éª¤**:
1. é€‰æ‹©è‡ªå®šä¹‰é•œåƒ
2. è¾“å…¥ä¸å­˜åœ¨çš„é•œåƒåœ°å€ï¼ˆå¦‚ `invalid-image:latest`ï¼‰
3. ä¿å­˜å¹¶éƒ¨ç½²

**é¢„æœŸç»“æœ**:
- éƒ¨ç½²å¤±è´¥
- Pod å¤„äº Init:ImagePullBackOff çŠ¶æ€
- å¯ä»¥æŸ¥çœ‹é”™è¯¯æ—¥å¿—

**æµ‹è¯•åœºæ™¯ B: ç½‘ç»œé—®é¢˜**

**æ­¥éª¤**:
1. åœ¨æ— æ³•è®¿é—®å¤–ç½‘çš„ç¯å¢ƒä¸­éƒ¨ç½²
2. ä½¿ç”¨éœ€è¦æ‹‰å–çš„é•œåƒï¼ˆå¦‚ nicolaka/netshootï¼‰

**é¢„æœŸç»“æœ**:
- æ˜¾ç¤ºé•œåƒæ‹‰å–å¤±è´¥é”™è¯¯
- æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯

---

### âœ… æµ‹è¯• 12: æ€§èƒ½å½±å“

**æ­¥éª¤**:
1. éƒ¨ç½²å¯ç”¨è°ƒè¯•å·¥å…·çš„æœåŠ¡
2. è®°å½•å¯åŠ¨æ—¶é—´
3. éƒ¨ç½²ä¸å¯ç”¨è°ƒè¯•å·¥å…·çš„æœåŠ¡
4. å¯¹æ¯”å¯åŠ¨æ—¶é—´

**é¢„æœŸç»“æœ**:
- BusyBox å·¥å…·é›†å¯åŠ¨æ—¶é—´å¢åŠ  < 5 ç§’
- Netshoot å·¥å…·é›†å¯åŠ¨æ—¶é—´å¢åŠ  < 15 ç§’
- è¿è¡Œæ—¶æ€§èƒ½æ— å½±å“

---

### âœ… æµ‹è¯• 13: å¤šå®¹å™¨åœºæ™¯

**æ­¥éª¤**:
1. éƒ¨ç½²å¤šä¸ªå¯ç”¨è°ƒè¯•å·¥å…·çš„æœåŠ¡
2. éªŒè¯æ¯ä¸ªæœåŠ¡çš„è°ƒè¯•å·¥å…·ç‹¬ç«‹å·¥ä½œ

**é¢„æœŸç»“æœ**:
- æ¯ä¸ªæœåŠ¡çš„è°ƒè¯•å·¥å…·äº’ä¸å½±å“
- å¯ä»¥åŒæ—¶ä½¿ç”¨

---

## å›å½’æµ‹è¯•

### âœ… æµ‹è¯• 14: ç°æœ‰åŠŸèƒ½ä¸å—å½±å“

**æ­¥éª¤**:
1. æµ‹è¯•æœåŠ¡çš„å…¶ä»–é…ç½®åŠŸèƒ½ï¼ˆç¯å¢ƒå˜é‡ã€å·æŒ‚è½½ã€ç½‘ç»œé…ç½®ç­‰ï¼‰
2. ç¡®ä¿ç°æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

**é¢„æœŸç»“æœ**:
- æ‰€æœ‰ç°æœ‰åŠŸèƒ½æ­£å¸¸
- æ²¡æœ‰å¼•å…¥æ–°çš„ bug

---

## æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•

### âœ… æµ‹è¯• 15: ä¸åŒæµè§ˆå™¨

**æµ‹è¯•æµè§ˆå™¨**:
- Chrome
- Firefox
- Safari
- Edge

**é¢„æœŸç»“æœ**:
- UI åœ¨æ‰€æœ‰æµè§ˆå™¨ä¸­æ­£å¸¸æ˜¾ç¤º
- åŠŸèƒ½åœ¨æ‰€æœ‰æµè§ˆå™¨ä¸­æ­£å¸¸å·¥ä½œ

---

## è¾¹ç•Œæ¡ä»¶æµ‹è¯•

### âœ… æµ‹è¯• 16: ç‰¹æ®Šå­—ç¬¦

**æ­¥éª¤**:
1. åœ¨æŒ‚è½½è·¯å¾„ä¸­è¾“å…¥ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ `/debug/tools`ã€`/debug-tools-v1`ï¼‰
2. ä¿å­˜å¹¶éƒ¨ç½²

**é¢„æœŸç»“æœ**:
- åˆæ³•è·¯å¾„å¯ä»¥æ­£å¸¸å·¥ä½œ
- éæ³•è·¯å¾„æ˜¾ç¤ºé”™è¯¯æç¤º

### âœ… æµ‹è¯• 17: é•¿æ–‡æœ¬

**æ­¥éª¤**:
1. è¾“å…¥å¾ˆé•¿çš„è‡ªå®šä¹‰é•œåƒåœ°å€
2. ä¿å­˜å¹¶éƒ¨ç½²

**é¢„æœŸç»“æœ**:
- UI æ­£å¸¸æ˜¾ç¤º
- åŠŸèƒ½æ­£å¸¸å·¥ä½œ

---

## æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

```markdown
## æµ‹è¯•æŠ¥å‘Š

**æµ‹è¯•æ—¥æœŸ**: YYYY-MM-DD
**æµ‹è¯•äººå‘˜**: [å§“å]
**ç¯å¢ƒ**: [å¼€å‘/æµ‹è¯•/ç”Ÿäº§]

### æµ‹è¯•ç»“æœæ±‡æ€»

| æµ‹è¯•é¡¹ | çŠ¶æ€ | å¤‡æ³¨ |
|--------|------|------|
| UI ç»„ä»¶æ˜¾ç¤º | âœ… / âŒ | |
| å¯ç”¨è°ƒè¯•å·¥å…· | âœ… / âŒ | |
| åˆ‡æ¢å·¥å…·é›† | âœ… / âŒ | |
| è‡ªå®šä¹‰é•œåƒ | âœ… / âŒ | |
| ä¿å­˜é…ç½® | âœ… / âŒ | |
| éƒ¨ç½² Application | âœ… / âŒ | |
| ä½¿ç”¨è°ƒè¯•å·¥å…· | âœ… / âŒ | |
| éƒ¨ç½² Database | âœ… / âŒ | |
| Netshoot å·¥å…·é›† | âœ… / âŒ | |
| ç¦ç”¨è°ƒè¯•å·¥å…· | âœ… / âŒ | |
| é”™è¯¯å¤„ç† | âœ… / âŒ | |
| æ€§èƒ½å½±å“ | âœ… / âŒ | |
| å¤šå®¹å™¨åœºæ™¯ | âœ… / âŒ | |
| ç°æœ‰åŠŸèƒ½ | âœ… / âŒ | |
| æµè§ˆå™¨å…¼å®¹æ€§ | âœ… / âŒ | |
| è¾¹ç•Œæ¡ä»¶ | âœ… / âŒ | |

### å‘ç°çš„é—®é¢˜

1. [é—®é¢˜æè¿°]
   - ä¸¥é‡ç¨‹åº¦: é«˜/ä¸­/ä½
   - å¤ç°æ­¥éª¤: ...
   - é¢„æœŸç»“æœ: ...
   - å®é™…ç»“æœ: ...

### å»ºè®®

1. [æ”¹è¿›å»ºè®®]

### æ€»ç»“

[æµ‹è¯•æ€»ç»“]
```

---

## å¿«é€ŸéªŒè¯è„šæœ¬

åˆ›å»ºä¸€ä¸ªå¿«é€ŸéªŒè¯è„šæœ¬ `scripts/test-debug-tools.sh`:

```bash
#!/bin/bash

set -e

echo "ğŸ§ª å¼€å§‹æµ‹è¯•è°ƒè¯•å·¥å…·åŠŸèƒ½..."

# 1. æ£€æŸ¥æ•°æ®åº“å­—æ®µ
echo "1ï¸âƒ£ æ£€æŸ¥æ•°æ®åº“å­—æ®µ..."
mysql -u root -p xuanwu_next -e "DESCRIBE services;" | grep debug_config || echo "âŒ debug_config å­—æ®µä¸å­˜åœ¨"

# 2. æ£€æŸ¥ UI ç»„ä»¶æ–‡ä»¶
echo "2ï¸âƒ£ æ£€æŸ¥ UI ç»„ä»¶æ–‡ä»¶..."
test -f src/components/services/configuration/DebugToolsSection.tsx && echo "âœ… DebugToolsSection.tsx å­˜åœ¨" || echo "âŒ DebugToolsSection.tsx ä¸å­˜åœ¨"
test -f src/components/ui/alert.tsx && echo "âœ… alert.tsx å­˜åœ¨" || echo "âŒ alert.tsx ä¸å­˜åœ¨"
test -f src/components/ui/switch.tsx && echo "âœ… switch.tsx å­˜åœ¨" || echo "âŒ switch.tsx ä¸å­˜åœ¨"
test -f src/components/ui/radio-group.tsx && echo "âœ… radio-group.tsx å­˜åœ¨" || echo "âŒ radio-group.tsx ä¸å­˜åœ¨"

# 3. æ£€æŸ¥ç±»å‹å®šä¹‰
echo "3ï¸âƒ£ æ£€æŸ¥ç±»å‹å®šä¹‰..."
grep -q "interface DebugConfig" src/types/project.ts && echo "âœ… DebugConfig ç±»å‹å­˜åœ¨" || echo "âŒ DebugConfig ç±»å‹ä¸å­˜åœ¨"

# 4. æ£€æŸ¥ K8s æœåŠ¡
echo "4ï¸âƒ£ æ£€æŸ¥ K8s æœåŠ¡..."
grep -q "buildDebugInitContainer" src/lib/k8s.ts && echo "âœ… buildDebugInitContainer æ–¹æ³•å­˜åœ¨" || echo "âŒ buildDebugInitContainer æ–¹æ³•ä¸å­˜åœ¨"

echo "âœ… æµ‹è¯•å®Œæˆï¼"
```

---

## å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: UI ä¸æ˜¾ç¤º

**æ£€æŸ¥**:
```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la src/components/services/configuration/DebugToolsSection.tsx

# æ£€æŸ¥æ˜¯å¦æ­£ç¡®å¯¼å…¥
grep "DebugToolsSection" src/components/services/ConfigurationTab.tsx
```

### é—®é¢˜ 2: ä¿å­˜å¤±è´¥

**æ£€æŸ¥**:
```bash
# æ£€æŸ¥ API helpers
grep "debug_config" src/app/api/services/helpers.ts

# æ£€æŸ¥æ•°æ®åº“å­—æ®µ
mysql -u root -p xuanwu_next -e "DESCRIBE services;" | grep debug_config
```

### é—®é¢˜ 3: éƒ¨ç½²å¤±è´¥

**æ£€æŸ¥**:
```bash
# æŸ¥çœ‹ Pod çŠ¶æ€
kubectl get pods -n <namespace> -l app=<service-name>

# æŸ¥çœ‹ Init Container æ—¥å¿—
kubectl logs <pod-name> -n <namespace> -c install-debug-tools

# æŸ¥çœ‹ Pod äº‹ä»¶
kubectl describe pod <pod-name> -n <namespace>
```

---

## æµ‹è¯•å®Œæˆæ ‡å‡†

- [ ] æ‰€æœ‰ 17 ä¸ªæµ‹è¯•é¡¹é€šè¿‡
- [ ] æ²¡æœ‰å‘ç°ä¸¥é‡æˆ–ä¸­ç­‰çº§åˆ«çš„ bug
- [ ] æ€§èƒ½å½±å“åœ¨å¯æ¥å—èŒƒå›´å†…
- [ ] æ–‡æ¡£å®Œæ•´ä¸”å‡†ç¡®
- [ ] ä»£ç é€šè¿‡ lint æ£€æŸ¥
- [ ] æ²¡æœ‰ TypeScript é”™è¯¯

---

## ä¸‹ä¸€æ­¥

æµ‹è¯•é€šè¿‡åï¼š
1. æäº¤ä»£ç åˆ°ç‰ˆæœ¬æ§åˆ¶
2. åˆ›å»º Pull Request
3. è¿›è¡Œ Code Review
4. éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
5. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
